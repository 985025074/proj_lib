# wireshark 书阅读笔记

## 捕获过滤器

捕获 选项 设备最右侧可以选择 可以输入如:
port 80

## 对应语法 EBF

跟C 语言一样 表示逻辑关系
src host 192.168.0.10 && port 80

### 限定地址

host ip
ether host mac

### 传输方向的限定

src host ip..
dst host ip..

### port 过滤类似与地址限定，只需要把host 换成port
此处略过

### 数据包字节比较

icmp[0:2]==0x0301
意味着进行前两个字节比较。

#### TCP 捕获 RST 数据包实例

tcp[13]&4==4
&4 意思是 第四位flag

## 显示过滤器  

显示过滤器 语法类似 但是使用or and not 

## 过滤器常用选项save

捕获过滤器： 捕获-> 捕获过滤器->修改
显示～:查看 + 号 首选项 即可打开

## 统计消息 statiscs 好处多

有endpoint端点设备统计 + 会话统计

## 首选项中配置 name resolution

- mac地址解析，如果失败。会尝试生成一个制造商名称.
- 解析传输名称（Resolve Transport name） ：这种类型的名称解
析尝试将一个端口号，转换成一个与其相关的名字。比如，将端口80
显示为http。当你碰到一个不常见的端口而又不知道这是什么协议的
时候，这个功能显得尤为便利。
- 解析网络名称（Resolve Network/IP name） ：这种类型的名称解
析试图转换第3层——网络层的地址，例如将IP地址192.168.1.50，转
换为一个易读的域名。假如域名具有高描述性，则对我们理解该系统
的目的或其所有者，将是非常有帮助的。

**重启之后才生效**

## 数据流图 IO 图

这些掠过了，就是一些统计数据

## 专家信息

这个感觉可能会很有用。包含了一些数据分析。

## 命令行 部分章节 暂时跳过

## 网络层协议分析

### ARP： 为什么需要ARP：
交换机使用一张表格CAM,来确定每个设备的地址。里面就是mac.他会负责进行IP 地址 到 MAC 地址 的转换。
#### ARP 实战
ARP 的基本过程就是：所有人 我的MAC + IP 是XXXX,请问谁的是XXXXX。然后符合这个地址的人会发出。而不符合的呢就会丢掉。

其中注意：请求者Ethernet层的MAC 地址是 FF.也就是广播地址。

#### 特殊ARP : gratuitous ARP

这种是自我宣布，我的ip地址变了。大家更新一下MAC + IP 的缓存记录吧。

### 局域网与 交换机

局域网：集线器 或者说交换机连接的网络： Lan.
路由器：负责将不同的局域网合并。

### IP

#### IP 地址

32位地址。其中每8位点分开。所以会有192.168.0.1 这种样子的地址出现

IP 地址 是用来确定复杂的网络的。
分为两个部分: 

- 网段地址
- 主机地址

前者，就是确定在那个局域网。后者意义显而易见。

确定那一部分是网段 那一部分是主机，就是靠子网掩码。

#### 重要字段之 TTL 存活时间

经过路由器就减去一。

#### IP分片 由于第二层链路层的数据限制，IP包可能会被分片。然后在目的地重新组装。

1）设备将数据分为若干个将要接下来进行传输的数据包。
（2）每个IP头的总长度字段会被设置为每个分片的片段长度。
（3）除了最后一个分片数据包外，之前所有分片数据包的标志位
都被标识为1。
（4）IP头中分片部分的分片偏移将会被设置。
（5）数据包被发送出去。

连续的fragment offset 可以indicate 是同一个

#### IPV6

在同一网络下和另一个设备通信需要用到本地连接地址。一个本
地连接地址的前10个最高有效位被设置为1111111010，紧接着的54位
被设置成0。所以，当你看到一个地址的前半部分是
fe80:0000:0000:0000时，你就可以认出这是一个本地连接地址。

本地链接：
关键的标识符通过MAC 变换得来
##### 两者区别：
源IP和目的IP的格式不一样。
IPv4的报文总长60字节，大小总共74字节，包括IPv4报头和14字
节的以太网报头。IPv6的报文总共96字节，包括一个40字节的
IPv6载荷、另一个40字节的IPv6报头和14字节的以太网报头。
IPv6为了有更大的地址空间而将报头设为40字节，是20字节IPv4
报头的2倍。
IPv4通过“协议”字段来确定下一层的协议类型，而IPv6通过“下一
包报头”字段（也可以用来指明拓展报头）。
IPv4有TTL值，而IPv6使用跳数限制来实现相同功能。
IPv4包含报头校验和值，而IPv6没有。
该IPv4报文没有被分片，但是仍然包含设置这些选项的值。IPv6
不会包含这些信息，因为如果有需要会在拓展报头里实现。
##### IPV6 使用 ICMPv6 来控制

IPV6 不是默认分片的 它自带一个拓展机制。会添加需要的功能。


## ICMP

重要应用就是 ping
ping的实质是发送echo类型的icmp请求。分别是 8（req） 0 (reply)
貌似是通过校验和 来判断是否一致？

### 与 ipv4 TTL 的配合

路由跟踪 一个TTL 为1 的ping包。逐次增加 知道找到目的地的 路由。


### TCP 

TCP UDP 引入全新概念 端口

#### 端口
1～1023是标准端口组（忽略掉被预留的0），特定服务会用到这
些通常位于标准端口分组中的标准端口。
1024～65535是临时端口组（尽管一些操作系统对此有着不同的定
义），当一个服务想在任何时间使用端口进行通信的时候，现代操作
系统都会随机地选择一个源端口，让通信使用唯一源端口。这些源端
口通常就位于临时端口组。

也就是说 源端口 是不重要的

#### TCP 三次握手

TCP握手分为3个步骤，如图8-5所示。在第一步中，主动发起通
信的设备（主机A）向目标（主机B）发送了一个TCP数据包。这个初
始数据包除了底层协议头之外不包含任何数据。这个数据包的TCP头
设置了SYN标志，并包含了在通信过程中会用到的初始序列号和最大
分段大小（MSS）。主机B对于这个数据包回复了一个类似的设置了
SYN和ACK标志以及包含了它初始序列号的数据包。最后，主机A向
主机B发送最后一个仅设置了ACK标志的数据包。在这个过程完成之
后，双方设备应该已经具有了开始正常通信所需的信息。

#### 断开
来回FINACK ACK


#### RST

无效

### UDP

没有握手 没有告别。只有直接开始

### DHCP

在网络时代的早期，当一台设备想要在网络上通信时，它需要被
手动分配一个地址。随着网络的发展，这样的手动过程很快就变得烦
琐起来。为了解决这个问题，BOOTP协议（Bootstrap Protocol）问
世，它主要的作用是给连接到网络的设备自动分配地址。BOOTP后来
被更加复杂的动态主机配置协议DHCP（Dynamic Host Configuration
Protocol）所取代。
DHCP是一个应用层协议，负责让设备能够自动获取IP地址（以
及其他重要的网络资源，比如DNS服务器和路由网关的地址）。今天
大多数的DHCP服务器都向客户端提供其他的一些参数，比如网络上
的默认网关和DNS服务器的地址。

**基于UDP**

#### DHCP IP 工作过程：

正如在引用的捕获文件中看到的那样，第一个数据包从0.0.0.0的
68端口发往255.255.255.255的67端口。客户端使用0.0.0.0，是因为它目
前还没有IP地址。数据包被发往255.255.255.255，是因为这是一个独
立于网络的广播地址，从而确保这个数据包会被发往网络上的每台设
备。因为这台设备并不知道DHCP服务器的地址，所以它的第一个数
据包是为了寻找正在监听的DHCP服务器。  

**由客户 发送一个 包 来寻找 DHCP 服务器**
